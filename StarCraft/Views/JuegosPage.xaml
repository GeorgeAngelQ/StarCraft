<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    x:Class="StarCraft.Views.JuegosPage"
    Title="Juegos"
    BackgroundColor="#0F0F0F">

    <ScrollView>
        <Grid Padding="20" RowSpacing="20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <!-- ENCABEZADO -->
            <Frame Grid.Row="0"
                   BackgroundColor="#1A1A1D"
                   BorderColor="#2D2D30"
                   CornerRadius="12"
                   HasShadow="True"
                   Padding="20">
                <HorizontalStackLayout Spacing="10" HorizontalOptions="Center">
                    <Label Text="🎮" FontSize="32" VerticalOptions="Center" />
                    <Label Text="Gestión de Juegos" 
                           FontSize="26" 
                           FontAttributes="Bold"
                           TextColor="#6C63FF"
                           VerticalOptions="Center" />
                </HorizontalStackLayout>
            </Frame>

            <!-- FORMULARIO -->
            <Frame Grid.Row="1"
                   BackgroundColor="#1A1A1D"
                   BorderColor="#2D2D30"
                   CornerRadius="12"
                   HasShadow="False"
                   Padding="20">
                <VerticalStackLayout Spacing="20">

                    <!-- Modalidad (NUEVO - obligatoria) -->
                    <VerticalStackLayout Spacing="8">
                        <Label Text="🎯 Modalidad *" 
                               FontAttributes="Bold"
                               TextColor="#E0E0E0"
                               FontSize="15" />
                        <Frame BackgroundColor="#252529"
                               BorderColor="#6C63FF"
                               CornerRadius="8"
                               Padding="0"
                               HasShadow="False">
                            <Picker x:Name="ModalidadPicker"
                                    TextColor="#FFFFFF"
                                    TitleColor="#808080"
                                    BackgroundColor="Transparent"
                                    SelectedIndexChanged="ModalidadPicker_SelectedIndexChanged" />
                        </Frame>
                    </VerticalStackLayout>

                    <!-- Serie (obligatoria) -->
                    <VerticalStackLayout Spacing="8">
                        <Label Text="📋 Serie *" 
                               FontAttributes="Bold"
                               TextColor="#E0E0E0"
                               FontSize="15" />
                        <Frame BackgroundColor="#252529"
                               CornerRadius="8"
                               Padding="0"
                               HasShadow="False">
                            <Picker x:Name="SeriePicker"
                                    TextColor="#FFFFFF"
                                    TitleColor="#808080"
                                    BackgroundColor="Transparent"
                                    SelectedIndexChanged="SeriePicker_SelectedIndexChanged" />
                        </Frame>
                    </VerticalStackLayout>

                    <!-- Separador -->
                    <BoxView HeightRequest="1" 
                             BackgroundColor="#3E3E42"
                             Margin="0,5"/>

                    <!-- Grid: Mapa y Ganador -->
                    <Grid ColumnDefinitions="*,*" ColumnSpacing="15">
                        <!-- Columna Izquierda: Mapa y Raza1 -->
                        <VerticalStackLayout Grid.Column="0" Spacing="15">
                            <!-- Mapa -->
                            <VerticalStackLayout Spacing="8">
                                <Label Text="🗺️ Mapa *" 
                                       FontAttributes="Bold"
                                       TextColor="#E0E0E0"
                                       FontSize="14" />
                                <Frame BackgroundColor="#252529"
                                       BorderColor="#3E3E42"
                                       CornerRadius="8"
                                       Padding="0"
                                       HasShadow="False">
                                    <Picker x:Name="MapaPicker" 
                                            TextColor="#FFFFFF"
                                            TitleColor="#808080"
                                            BackgroundColor="Transparent"
                                            IsEnabled="False" />
                                </Frame>
                            </VerticalStackLayout>

                            <!-- Raza Jugador 1 -->
                            <VerticalStackLayout Spacing="8">
                                <Label Text="⚔️ Raza Jugador 1" 
                                       FontAttributes="Bold"
                                       TextColor="#E0E0E0"
                                       FontSize="14" />
                                <Frame BackgroundColor="#252529"
                                       BorderColor="#3E3E42"
                                       CornerRadius="8"
                                       Padding="0"
                                       HasShadow="False">
                                    <Picker x:Name="Raza1Picker"
                                            TextColor="#FFFFFF"
                                            TitleColor="#808080"
                                            BackgroundColor="Transparent"
                                            IsEnabled="False"/>
                                </Frame>
                            </VerticalStackLayout>
                        </VerticalStackLayout>

                        <!-- Columna Derecha: Ganador y Raza2 -->
                        <VerticalStackLayout Grid.Column="1" Spacing="15">
                            <!-- Ganador -->
                            <VerticalStackLayout Spacing="8">
                                <Label Text="🏆 Ganador *" 
                                       FontAttributes="Bold"
                                       TextColor="#E0E0E0"
                                       FontSize="14" />
                                <Frame BackgroundColor="#252529"
                                       BorderColor="#3E3E42"
                                       CornerRadius="8"
                                       Padding="0"
                                       HasShadow="False">
                                    <Picker x:Name="GanadorPicker"
                                            TextColor="#FFFFFF"
                                            TitleColor="#808080"
                                            BackgroundColor="Transparent"
                                            IsEnabled="False"/>
                                </Frame>
                            </VerticalStackLayout>

                            <!-- Raza Jugador 2 -->
                            <VerticalStackLayout Spacing="8">
                                <Label Text="⚔️ Raza Jugador 2" 
                                       FontAttributes="Bold"
                                       TextColor="#E0E0E0"
                                       FontSize="14" />
                                <Frame BackgroundColor="#252529"
                                       BorderColor="#3E3E42"
                                       CornerRadius="8"
                                       Padding="0"
                                       HasShadow="False">
                                    <Picker x:Name="Raza2Picker"
                                            TextColor="#FFFFFF"
                                            TitleColor="#808080"
                                            BackgroundColor="Transparent"
                                            IsEnabled="False"/>
                                </Frame>
                            </VerticalStackLayout>
                        </VerticalStackLayout>
                    </Grid>

                    <!-- Botones de Acción -->
                    <Grid ColumnSpacing="15">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>

                        <Button Grid.Column="0"
                                x:Name="BtnGuardar"
                                Text="💾 GUARDAR"
                                BackgroundColor="#6C63FF"
                                TextColor="White"
                                FontAttributes="Bold"
                                FontSize="15"
                                CornerRadius="8"
                                HeightRequest="50"
                                Clicked="GuardarButton_Clicked">
                            <Button.Shadow>
                                <Shadow Brush="#6C63FF" Opacity="0.5" Radius="15" Offset="0,5" />
                            </Button.Shadow>
                        </Button>

                        <Button Grid.Column="1"
                                Text="🔄 NUEVO"
                                BackgroundColor="#3E3E42"
                                TextColor="White"
                                FontAttributes="Bold"
                                FontSize="15"
                                CornerRadius="8"
                                HeightRequest="50"
                                Clicked="NuevoButton_Clicked">
                            <Button.Shadow>
                                <Shadow Brush="#3E3E42" Opacity="0.4" Radius="12" Offset="0,4" />
                            </Button.Shadow>
                        </Button>
                    </Grid>
                </VerticalStackLayout>
            </Frame>

            <!-- LISTA DE JUEGOS -->
            <Frame Grid.Row="2"
                   BackgroundColor="#1A1A1D"
                   BorderColor="#2D2D30"
                   CornerRadius="12"
                   HasShadow="True"
                   Padding="20">
                <Grid RowSpacing="15">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <!-- Título -->
                    <HorizontalStackLayout Grid.Row="0" Spacing="10">
                        <Label Text="📋" FontSize="20" VerticalOptions="Center"/>
                        <Label Text="Juegos Registrados" 
                               FontSize="18"
                               FontAttributes="Bold"
                               TextColor="#6C63FF"
                               VerticalOptions="Center"/>
                    </HorizontalStackLayout>

                    <!-- Buscador -->
                    <Frame Grid.Row="1"
                           BackgroundColor="#252529"
                           BorderColor="#3E3E42"
                           CornerRadius="8"
                           Padding="0"
                           HasShadow="False">
                        <SearchBar x:Name="SearchBarJuegos"
                                   Placeholder="🔍 Buscar por jugador, mapa, raza, modalidad..."
                                   PlaceholderColor="#808080"
                                   TextColor="#FFFFFF"
                                   CancelButtonColor="#6C63FF"
                                   BackgroundColor="Transparent"
                                   TextChanged="SearchBar_TextChanged" />
                    </Frame>

                    <!-- Selector de items por página y contador -->
                    <Grid Grid.Row="2" ColumnSpacing="15">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <HorizontalStackLayout Grid.Column="0" Spacing="10" VerticalOptions="Center">
                            <Label Text="Mostrar:" 
                                   TextColor="#E0E0E0"
                                   VerticalOptions="Center"/>
                            <Frame BackgroundColor="#252529"
                                   BorderColor="#3E3E42"
                                   CornerRadius="6"
                                   Padding="0"
                                   HasShadow="False">
                                <Picker x:Name="PickerItemsPorPagina"
                                        TextColor="#FFFFFF"
                                        TitleColor="#808080"
                                        BackgroundColor="Transparent"
                                        WidthRequest="80"
                                        SelectedIndex="0"
                                        SelectedIndexChanged="OnItemsPorPaginaChanged">
                                    <Picker.ItemsSource>
                                        <x:Array Type="{x:Type x:String}">
                                            <x:String>10</x:String>
                                            <x:String>15</x:String>
                                            <x:String>20</x:String>
                                            <x:String>30</x:String>
                                        </x:Array>
                                    </Picker.ItemsSource>
                                </Picker>
                            </Frame>
                        </HorizontalStackLayout>

                        <Label Grid.Column="2"
                               x:Name="LblTotalRegistros"
                               Text="Total: 0 juego(s)"
                               TextColor="#B8B8B8"
                               FontSize="14"
                               HorizontalOptions="End"
                               VerticalOptions="Center"/>
                    </Grid>

                    <!-- CollectionView -->
                    <CollectionView Grid.Row="3"
                                   x:Name="JuegosCollection"
                                   SelectionMode="Single"
                                   SelectionChanged="JuegosCollection_SelectionChanged">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Frame BackgroundColor="#252529"
                                       BorderColor="#3E3E42"
                                       CornerRadius="10"
                                       Padding="15"
                                       Margin="0,8"
                                       HasShadow="False">
                                    <Grid ColumnDefinitions="*,Auto" ColumnSpacing="15">
                                        <!-- Información del juego -->
                                        <VerticalStackLayout Grid.Column="0" Spacing="6">
                                            <Label Text="{Binding SerieText}" 
                                                   FontAttributes="Bold" 
                                                   FontSize="15"
                                                   TextColor="#FFFFFF"/>
                                            <HorizontalStackLayout Spacing="5">
                                                <Label Text="🗺️" FontSize="13"/>
                                                <Label Text="{Binding MapaNombre}" 
                                                       FontSize="13"
                                                       TextColor="#B8B8B8"/>
                                            </HorizontalStackLayout>
                                            <HorizontalStackLayout Spacing="5">
                                                <Label Text="⚔️" FontSize="13"/>
                                                <Label FontSize="13" TextColor="#B8B8B8">
                                                    <Label.FormattedText>
                                                        <FormattedString>
                                                            <Span Text="{Binding RazaJugador1}"/>
                                                            <Span Text=" vs "/>
                                                            <Span Text="{Binding RazaJugador2}"/>
                                                        </FormattedString>
                                                    </Label.FormattedText>
                                                </Label>
                                            </HorizontalStackLayout>
                                            <HorizontalStackLayout Spacing="5">
                                                <Label Text="🏆" FontSize="13"/>
                                                <Label Text="{Binding GanadorAlias}" 
                                                       FontSize="13"
                                                       TextColor="#6C63FF"
                                                       FontAttributes="Bold"/>
                                            </HorizontalStackLayout>
                                        </VerticalStackLayout>

                                        <!-- Botones de acción -->
                                        <VerticalStackLayout Grid.Column="1" 
                                                            Spacing="8"
                                                            VerticalOptions="Center">
                                            <Button Text="✏️"
                                                    BackgroundColor="#6C63FF"
                                                    TextColor="White"
                                                    CornerRadius="8"
                                                    WidthRequest="45"
                                                    HeightRequest="45"
                                                    FontSize="18"
                                                    Clicked="EditarButton_Clicked" 
                                                    CommandParameter="{Binding IdJuego}">
                                                <Button.Shadow>
                                                    <Shadow Brush="#6C63FF" Opacity="0.4" Radius="8" Offset="0,3" />
                                                </Button.Shadow>
                                            </Button>
                                            <Button Text="🗑️"
                                                    BackgroundColor="#FF6B6B"
                                                    TextColor="White"
                                                    CornerRadius="8"
                                                    WidthRequest="45"
                                                    HeightRequest="45"
                                                    FontSize="18"
                                                    Clicked="EliminarButton_Clicked" 
                                                    CommandParameter="{Binding IdJuego}">
                                                <Button.Shadow>
                                                    <Shadow Brush="#FF6B6B" Opacity="0.4" Radius="8" Offset="0,3" />
                                                </Button.Shadow>
                                            </Button>
                                        </VerticalStackLayout>
                                    </Grid>
                                </Frame>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>

                    <!-- Controles de paginación -->
                    <Frame Grid.Row="4"
                           BackgroundColor="#252529"
                           BorderColor="#3E3E42"
                           CornerRadius="8"
                           Padding="15"
                           HasShadow="False">
                        <Grid ColumnSpacing="10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <Button Grid.Column="0"
                                    x:Name="BtnPrimeraPagina"
                                    Text="⏮️"
                                    BackgroundColor="#3E3E42"
                                    TextColor="White"
                                    CornerRadius="6"
                                    WidthRequest="50"
                                    HeightRequest="40"
                                    FontSize="16"
                                    Clicked="OnPrimeraPaginaClicked"/>

                            <Button Grid.Column="1"
                                    x:Name="BtnAnterior"
                                    Text="◀️"
                                    BackgroundColor="#3E3E42"
                                    TextColor="White"
                                    CornerRadius="6"
                                    WidthRequest="50"
                                    HeightRequest="40"
                                    FontSize="16"
                                    Clicked="OnAnteriorClicked"/>

                            <Frame Grid.Column="2"
                                   BackgroundColor="#1A1A1D"
                                   BorderColor="#6C63FF"
                                   CornerRadius="6"
                                   Padding="10,5"
                                   HasShadow="False"
                                   HorizontalOptions="Center"
                                   VerticalOptions="Center">
                                <Label x:Name="LblPaginaActual"
                                       Text="Página 1 de 1"
                                       TextColor="#6C63FF"
                                       FontAttributes="Bold"
                                       FontSize="14"
                                       HorizontalOptions="Center"
                                       VerticalOptions="Center"/>
                            </Frame>

                            <Button Grid.Column="3"
                                    x:Name="BtnSiguiente"
                                    Text="▶️"
                                    BackgroundColor="#3E3E42"
                                    TextColor="White"
                                    CornerRadius="6"
                                    WidthRequest="50"
                                    HeightRequest="40"
                                    FontSize="16"
                                    Clicked="OnSiguienteClicked"/>

                            <Button Grid.Column="4"
                                    x:Name="BtnUltimaPagina"
                                    Text="⏭️"
                                    BackgroundColor="#3E3E42"
                                    TextColor="White"
                                    CornerRadius="6"
                                    WidthRequest="50"
                                    HeightRequest="40"
                                    FontSize="16"
                                    Clicked="OnUltimaPaginaClicked"/>
                        </Grid>
                    </Frame>
                </Grid>
            </Frame>
        </Grid>
    </ScrollView>
</ContentPage>